<element name="racer-list" extends="racer-element" attributes="itemType at reverse itemAttributes">
  <template>
    <smart-list id="list"></smart-list>
  </template>
  <script>
    Polymer.register(this, {
      get items() {
        return this.$.list.items;
      },
      push: function(item) {
        this.insert(this.items.length, item);
      },
      unshift: function(item) {
        this.insert(0, item);
      },
      insert: function(i, model) {
        this._model.insert(this.at, i, model || {});
      },
      del: function(i) {
        this._model.del(this.at, i, 1);
      },
      add: function(i) {
        var wrapper = document.createElement("racer-element"),
        attr;

        if (!this.itemType) throw new Error("itemType was not declared");
        wrapper.child = document.createElement(this.itemType);
        wrapper.model = this._model.at(this.at + "." + i);
        if (this.itemAttributes) {
          for (attr in this.itemAttributes) {
            wrapper.child[attr] = this.itemAttributes[attr];
          }
        }
        if (this.reverse) {
          i = this.items.length - i;
        }
        wrapper.id = "r-" + i;
        this.$.list.insert(i, wrapper);
      },
      onModelLoad: function() {
        var key,
        data,
        i = 0;

        if (!this.at) throw new Error("at attribute must be specified");
        data = this._model.get(this.at);

        for (i = 0; i < data.length; i++) {
          this.add(i);
        };

        this.trigger("items:load");
      },
      onItemDelete: function(i) {
        this.$.list.removeByIndex(i);
      },
      onItemCreate: function(i) {
        this.add(i);
      },
      onItemUpdate: function(i, data) {
        this.$.list.items[i].update(data);
      },
      onChange: function(i, data) {
        this.trigger("item:update", i, data);
      },
      onInsert: function(i) {
        this.trigger("item:create", i);
      },
      onRemove: function(i) {
        this.trigger("item:delete", i);
      }
    });
  </script>
</element>
